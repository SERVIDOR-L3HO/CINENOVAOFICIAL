<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CINENOVA - Streaming de Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Outfit', sans-serif; }
        body { background-color: #080808; color: white; overflow-x: hidden; }
        .glass { background: rgba(15, 15, 15, 0.7); backdrop-filter: blur(12px); }
        .movie-card:hover { transform: translateY(-10px) scale(1.02); }
        .hero-shadow { background: linear-gradient(to top, #080808 0%, transparent 100%); }
        .glow-red { box-shadow: 0 0 30px rgba(239, 68, 68, 0.4); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #080808; }
        ::-webkit-scrollbar-thumb { background: #ef4444; border-radius: 10px; }
    </style>
</head>
<body>
    <nav class="fixed w-full z-[100] glass px-8 py-4 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center gap-12">
            <img src="/assets/logo_full.png" alt="CINENOVA" class="h-12 cursor-pointer" onclick="loadContent('movies')">
            <div class="hidden md:flex gap-8 text-sm font-bold tracking-widest uppercase">
                <a href="#" class="text-white hover:text-red-500 transition" onclick="loadCategory('movies')">CINE</a>
                <a href="#" class="text-gray-400 hover:text-red-500 transition" onclick="loadCategory('series')">SERIES</a>
                <a href="#" class="text-gray-400 hover:text-red-500 transition" onclick="loadCategory('tv')">TV EN VIVO</a>
            </div>
        </div>
        <div class="flex items-center gap-6">
            <div class="relative hidden sm:block">
                <input type="text" id="search-input" placeholder="Buscar..." class="bg-white/5 border border-white/10 rounded-full px-6 py-2 text-sm focus:outline-none focus:border-red-500 w-64 transition">
                <i class="fas fa-search absolute right-4 top-2.5 text-gray-500"></i>
            </div>
            <img src="/assets/logo_l3ho.png" alt="L3HO" class="h-8 hover:scale-110 transition">
        </div>
    </nav>

    <main id="main-content">
        <!-- Hero -->
        <div id="hero" class="relative h-[90vh] w-full flex items-end p-12 overflow-hidden">
            <div id="hero-bg" class="absolute inset-0 bg-cover bg-center transition-opacity duration-1000 scale-105" style="background-image: url('')"></div>
            <div class="absolute inset-0 bg-black/40"></div>
            <div class="absolute inset-0 hero-shadow"></div>
            
            <div class="relative z-10 max-w-3xl">
                <div class="flex items-center gap-2 mb-4">
                    <span class="bg-red-600 text-[10px] font-black px-2 py-1 rounded italic uppercase">EXCLUSIVO</span>
                    <span id="hero-year" class="text-gray-300 font-bold">2024</span>
                </div>
                <h1 id="hero-title" class="text-7xl font-black mb-6 leading-none uppercase italic tracking-tighter">CARGANDO...</h1>
                <p id="hero-desc" class="text-lg text-gray-200 mb-8 line-clamp-3 leading-relaxed opacity-80"></p>
                <div class="flex gap-4">
                    <button id="hero-play" class="bg-red-600 hover:bg-red-700 px-10 py-4 rounded-full font-black text-sm flex items-center gap-3 glow-red transition-all transform hover:scale-105">
                        <i class="fas fa-play"></i> REPRODUCIR AHORA
                    </button>
                    <button class="bg-white/10 hover:bg-white/20 px-10 py-4 rounded-full font-black text-sm backdrop-blur-md transition">
                        DETALLES
                    </button>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="px-12 py-10">
            <h2 id="section-title" class="text-3xl font-black italic uppercase tracking-tighter mb-8 flex items-center gap-3">
                <span class="w-1.5 h-10 bg-red-600"></span> LO MÁS TOP
            </h2>
            <div id="content-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-8">
                <!-- Cards -->
            </div>
        </div>
    </main>

    <!-- Player -->
    <div id="player-view" class="fixed inset-0 z-[200] bg-black hidden flex flex-col">
        <div class="p-6 flex justify-between items-center bg-zinc-950/80 border-b border-white/5 backdrop-blur-xl">
            <div class="flex items-center gap-4">
                <img src="/assets/logo_icon.png" class="h-10">
                <div>
                    <h3 id="player-title" class="font-black italic uppercase">Título</h3>
                    <p id="player-info" class="text-xs text-red-500 font-bold tracking-widest uppercase">Streaming VIP Activo</p>
                </div>
            </div>
            <button onclick="closePlayer()" class="w-12 h-12 flex items-center justify-center bg-white/5 hover:bg-red-600 rounded-full transition group">
                <i class="fas fa-times text-xl group-hover:rotate-90 transition"></i>
            </button>
        </div>
        <div class="flex-grow relative bg-black">
            <iframe id="video-frame" class="w-full h-full" frameborder="0" allowfullscreen></iframe>
            <div id="loading-spinner" class="absolute inset-0 flex items-center justify-center bg-black">
                <div class="w-16 h-16 border-4 border-red-600 border-t-transparent rounded-full animate-spin"></div>
            </div>
        </div>
    </div>

    <script>
        let currentType = 'movies';

        async function loadContent(type = 'movies') {
            currentType = type;
            const res = await fetch(`/api/${type}`);
            const data = await res.json();
            renderGrid(data, type);
            if(data.length > 0) updateHero(data[0]);
        }

        function renderGrid(data, type) {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = '';
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'movie-card relative group cursor-pointer transition-all duration-500';
                card.onclick = () => openPlayer(item, type);
                card.innerHTML = `
                    <div class="aspect-[2/3] rounded-2xl overflow-hidden relative border border-white/5">
                        <img src="${item.poster}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"></div>
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-500">
                            <div class="w-14 h-14 bg-red-600 rounded-full flex items-center justify-center glow-red">
                                <i class="fas fa-play text-white ml-1"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-4 left-4 right-4">
                            <h3 class="font-black text-sm uppercase italic tracking-tighter truncate">${item.title}</h3>
                            <div class="flex justify-between items-center mt-1">
                                <span class="text-[10px] text-gray-400 font-bold">${item.year}</span>
                                <span class="text-[10px] text-red-500 font-black">${item.rating.toFixed(1)} ⭐</span>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function updateHero(item) {
            const bg = document.getElementById('hero-bg');
            bg.style.opacity = '0';
            setTimeout(() => {
                bg.style.backgroundImage = `url('${item.banner}')`;
                bg.style.opacity = '1';
            }, 500);
            document.getElementById('hero-title').innerText = item.title;
            document.getElementById('hero-desc').innerText = item.overview;
            document.getElementById('hero-year').innerText = item.year;
            document.getElementById('hero-play').onclick = () => openPlayer(item, currentType);
        }

        function openPlayer(item, type) {
            const modal = document.getElementById('player-view');
            const frame = document.getElementById('video-frame');
            const spinner = document.getElementById('loading-spinner');
            
            document.getElementById('player-title').innerText = item.title;
            
            let url = type === 'movies' ? item.embeds.vip : `/api/series/${item.id}/episode?s=1&e=1`;
            
            if (type === 'series') {
                fetch(url).then(r => r.json()).then(d => frame.src = d.vip);
            } else {
                frame.src = url;
            }

            modal.classList.remove('hidden');
            spinner.classList.remove('hidden');
            frame.onload = () => spinner.classList.add('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closePlayer() {
            const modal = document.getElementById('player-view');
            const frame = document.getElementById('video-frame');
            frame.src = '';
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function loadCategory(cat) {
            document.getElementById('section-title').innerText = cat === 'movies' ? 'CINE PREMIERE' : 'SERIES EXCLUSIVAS';
            loadContent(cat);
        }

        // Search
        document.getElementById('search-input').onkeyup = async (e) => {
            if(e.target.value.length > 2) {
                const res = await fetch(`/api/movies/search?query=${e.target.value}`);
                const data = await res.json();
                renderGrid(data, 'movies');
            }
        };

        loadContent('movies');
    </script>
</body>
</html>